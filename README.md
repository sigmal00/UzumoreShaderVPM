# UzumoreShader 
埋もれシェーダーはカメラがメッシュの内側に潜り込んだ際に頂点をカメラの正面まで押し戻すことでメッシュの内側を見えなくするシェーダーです。
liltoonのカスタムシェーダー機能を用いて作成されています。

## 導入
1. [こちら](https://sigmal00.github.io/UzumoreShaderVPM/)のURLにアクセスし "Add To VCC" を選択してVCCに追加
2. VCCを開き、シェーダーを追加したいプロジェクトの"Manage Project"を選択
3. パッケージ一覧から"UzumoreShader"を探してプロジェクトに追加する。
4. インポートが完了するとマテリアルのシェーダー選択欄から"Sigmal00/Uzumore/..."以下のシェーダーが選択できるようになります。

### unitypackage版から移行する場合
プロジェクトにすでに[unitypackage版の埋もれシェーダー](https://github.com/sigmal00/UzumoreShader)をインポートしている方向けの手順です。
1. [こちら](https://sigmal00.github.io/UzumoreShaderVPM/)のURLにアクセスし "Add To VCC" を選択してVCCに追加
2. プロジェクトを閉じてからエクスプローラーなどで"Assets\Sigmal00\UzumoreShader"以下のフォルダを削除する。
3. VCCを開き、シェーダーを追加したいプロジェクトの"Manage Project"を選択
4. パッケージ一覧から"UzumoreShader"を探してプロジェクトに追加する。
5. インポートが完了するとマテリアルのシェーダー選択欄から"Sigmal00/Uzumore/..."以下のシェーダーが選択できるようになります。


既にliltoonシェーダーのパラメータを設定済みのマテリアルがある場合は、マテリアルのシェーダー選択欄からシェーダーを埋もれシェーダーに切り替えれば、パラメータを維持したまま埋もれシェーダーに切り替えることができます。
* 輪郭線設定をしていた場合に輪郭線設定のチェックが外れることがあります。その場合は再度チェックを入れなおしてください。

## パラメータ説明
### どこまで埋もれるか（ｍ）
カメラがメッシュの内側に潜り込んだとき、何メートルまで押し戻してくれるかを設定します。

値が大きすぎると意図しない場面で埋もれが発生することがあるので、0.1～0.2くらいにしたほうが無難です。

### 埋もれマスク
押し戻してくれる範囲のマスクです。

どこまで埋もれるかの値にRチャンネルの値が乗算されます。

端的に言うとテクスチャの白いところが埋もれて黒いところは埋もれなくなります。

手や胸元など埋もれさせたい場所をマスクしたテクスチャを用意すると、意図しない場面で埋もれるのを防ぐことができます。

### 埋もれバイアス（ｍ）
#### ver1.0.1以降
Z-Fightを防ぐためのパラメータです。
Z-Fightを起こす（メッシュがチラつく）場合にはこの値を大きくしてみてください。

#### ver1.0.0

頂点の押し戻しが始まる距離に対するバイアス値です。

埋もれシェーダーを適用したメッシュ同士が重なってZ-Fightを起こす場合はこの値を調整してください。

その際は内側にあるメッシュは外側にあるメッシュよりもこの値を大きく設定してください。

例として、服メッシュのバイアス値が0.001のときは肌メッシュのバイアス値を0.002に設定すると良いでしょう。

## Q&A
### 服に埋もれシェーダー適用して埋もれたら肌メッシュが貫通してきた
肌にも埋もれシェーダーを適用してください。

### 埋もれても暗くならない
liltoonの距離フェードを設定してください。

### 人の背後に立ったら相手の視界が塞がってしまった
おそらく背中のメッシュが相手の眼前まで押し戻されています。

どこまで埋もれるかの値を小さくするか、埋もれマスクに埋もれさせたい範囲をマスクしたテクスチャを設定してみてください。
